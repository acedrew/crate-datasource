{"version":3,"sources":["../src/query_builder.js"],"names":[],"mappings":";;;;;AAyBA,WAAS,kBAAT,CAA4B,YAA5B,EAA0C;AACxC,QAAI,kBAAkB,EAAE,GAAF,CAAM,YAAN,EAAoB,UAAC,SAAD,EAAY,KAAZ,EAAsB;AAC9D,UAAI,WAAW,EAAf;AACA,UAAI,UAAU,CAAd,EAAiB;AACf,oBAAY,MAAM,UAAU,SAA5B;AACD;AACD,UAAI,QAAQ,EAAE,QAAF,CAAW,UAAU,KAArB,IAA8B,OAAO,UAAU,KAAjB,CAA9B,GAAwD,MAAM,UAAU,KAAhB,GAAwB,GAA5F;AACA,kBAAY,MAAM,UAAU,IAAhB,GAAuB,GAAvB,GAA6B,UAAU,QAAvC,GAAkD,GAAlD,GAAwD,KAApE;AACA,aAAO,QAAP;AACD,KARqB,CAAtB;AASA,WAAO,gBAAgB,IAAhB,CAAqB,GAArB,CAAP;AACD;;;;AApCM,O;;;AAEA,eAAS,SAAT,GAAqB;AAC1B,YAAI,QAAQ,kDAAZ;AACA,eAAO,KAAP;AACD;;;;AAEM,eAAS,UAAT,CAAoB,KAApB,EAA2B;AAChC,YAAI,QAAQ,0EACV,KADU,GACF,GADV;AAEA,eAAO,KAAP;AACD;;;;AAEM,eAAS,SAAT,CAAmB,KAAnB,EAA0B,MAA1B,EAAkC,KAAlC,EAAyC;AAC9C,YAAI,QAAQ,qBAAqB,MAArB,GAA8B,QAA9B,GAAyC,KAArD;AACA,YAAI,KAAJ,EAAW;AACT,mBAAS,YAAY,KAArB;AACD;AACD,eAAO,KAAP;AACD;;;;AAEM,eAAS,YAAT,CAAsB,KAAtB,EAA6B,QAA7B,EAAuC,MAAvC,EAA+C;AACpD,eAAO,QAAQ,gBAAR,GAA2B,QAA3B,GAAsC,cAAtC,GAAuD,MAA9D;AACD;;;AAeM,eAAS,UAAT,CAAoB,MAApB,EAA4B,QAA5B,EAAsC,MAAtC,EAA8C;AACnD,YAAI,QAAQ,SAAZ;AACA,gBAAQ,QAAQ,OAAO,aAAP,CAAqB,IAArB,EAAhB;AACA,gBAAQ,QAAQ,QAAR,GAAmB,OAAO,KAAlC;;;AAGA,YAAI,OAAO,YAAP,IAAuB,OAAO,YAAP,CAAoB,MAA/C,EAAuD;AACrD,mBAAS,WAAW,mBAAmB,OAAO,YAA1B,CAApB;AACD;;;AAGD,YAAI,YAAY,MAAhB,EAAwB;AACtB,cAAI,CAAC,OAAO,YAAR,IAAwB,OAAO,YAAP,CAAoB,MAApB,KAA+B,CAA3D,EAA8D;AAC5D,qBAAS,SAAT;AACD,WAFD,MAEO;AACL,qBAAS,OAAT;AACD;AACD,cAAI,aAAa,OAAO,OAAxB;AACA,mBAAS,aAAa,KAAb,GAAqB,QAArB,GACP,OADO,GACG,UADH,GACgB,KADhB,GACwB,MADjC;AAED;;;AAGD,gBAAQ,QAAQ,YAAR,GAAuB,OAAO,OAA9B,GAAwC,GAAxC,GAA8C,OAAO,SAA7D;AACA,eAAO,KAAP;AACD","file":"query_builder.js","sourcesContent":["import _ from 'lodash';\n\nexport function getTables() {\n  var query = \"SELECT table_name FROM information_schema.tables\";\n  return query;\n}\n\nexport function getColumns(table) {\n  var query = \"SELECT column_name FROM information_schema.columns WHERE table_name='\" +\n    table + \"'\";\n  return query;\n}\n\nexport function getValues(table, column, limit) {\n  var query = \"SELECT DISTINCT \" + column + \" FROM \" + table;\n  if (limit) {\n    query += \" LIMIT \" + limit;\n  }\n  return query;\n}\n\nexport function addTimeRange(query, timeFrom, timeTo) {\n  return query + \" WHERE time > \" + timeFrom + \" AND time < \" + timeTo;\n}\n\nfunction renderWhereClauses(whereClauses) {\n  var renderedClauses = _.map(whereClauses, (clauseObj, index) => {\n    var rendered = \"\";\n    if (index !== 0) {\n      rendered += ' ' + clauseObj.condition;\n    }\n    var right = _.isNumber(clauseObj.right) ? Number(clauseObj.right) : \"'\" + clauseObj.right + \"'\";\n    rendered += ' ' + clauseObj.left + ' ' + clauseObj.operator + ' ' + right;\n    return rendered;\n  });\n  return renderedClauses.join(' ');\n}\n\nexport function buildQuery(target, timeFrom, timeTo) {\n  var query = \"SELECT \";\n  query = query + target.selectColumns.join();\n  query = query + \" FROM \" + target.table;\n\n  // WHERE\n  if (target.whereClauses && target.whereClauses.length) {\n    query += \" WHERE\" + renderWhereClauses(target.whereClauses);\n  }\n\n  // Add time range\n  if (timeFrom || timeTo) {\n    if (!target.whereClauses || target.whereClauses.length === 0) {\n      query += \" WHERE \";\n    } else {\n      query += \" AND \";\n    }\n    var timeColumn = target.orderBy;\n    query += timeColumn + \" > \" + timeFrom +\n      \" AND \" + timeColumn + \" < \" + timeTo;\n  }\n\n  // ORDER BY\n  query = query + \" ORDER BY \" + target.orderBy + \" \" + target.orderType;\n  return query;\n}"]}