<query-editor-row query-ctrl="ctrl" has-text-edit-mode="true">

  <!-- Raw editor -->
  <div class="gf-form" ng-if="ctrl.target.rawQuery">
    <input type="text" class="gf-form-input"
      ng-model="ctrl.target.query"
      spellcheck="false"
      ng-blur="ctrl.onChangeInternal()">
    </input>
  </div>

  <!-- Crate SQL query editor -->
  <div ng-if="!ctrl.target.rawQuery">

    <div class="gf-form-inline">
      <div class="gf-form">
        <label class="gf-form-label query-keyword width-7">FROM</label>
        <metric-segment segment="ctrl.schemaSegment"
          get-options="ctrl.getSchemas()"
          on-change="ctrl.schemaChanged()">
        </metric-segment>
        <metric-segment segment="ctrl.tableSegment"
          get-options="ctrl.getTables()"
          on-change="ctrl.tableChanged()">
        </metric-segment>
      </div>

      <div class="gf-form">
        <label class="gf-form-label query-keyword">WHERE</label>
      </div>
      <div class="gf-form" ng-repeat="segment in ctrl.whereSegments">
        <metric-segment segment="segment"
          get-options="ctrl.getColumnsOrValues(segment, $index)"
          on-change="ctrl.whereSegmentUpdated(segment, $index)">
        </metric-segment>
      </div>

      <div class="gf-form gf-form--grow">
        <div class="gf-form-label gf-form-label--grow"></div>
      </div>
    </div>

    <div class="gf-form-inline">
      <div class="gf-form">
        <label class="gf-form-label query-keyword width-7">
          <span>SELECT</span>
        </label>
      </div>
      <div class="gf-form" ng-repeat="segment in ctrl.selectColumnSegments">
        <metric-segment segment="segment"
          get-options="ctrl.getColumns()"
          on-change="ctrl.columnSegmentChanged(segment, $index)">
        </metric-segment>
      </div>
      <div class="gf-form gf-form--grow">
        <div class="gf-form-label gf-form-label--grow"></div>
      </div>
    </div>

    <div class="gf-form-inline"
      ng-repeat="agg in ctrl.target.metricAggs"
      ng-class="{'gf-form-disabled': agg.hide}">
      <div class="gf-form">
        <label class="gf-form-label query-keyword width-7">
          SELECT
          &nbsp;
          <a ng-click="ctrl.toggleShowMetric()"
            bs-tooltip="'Click to toggle show / hide metric'">
            <i class="fa fa-eye" ng-hide="agg.hide"></i>
            <i class="fa fa-eye-slash" ng-show="agg.hide"></i>
          </a>
        </label>
      </div>

      <div class="gf-form">
        <metric-segment-model property="agg.type"
          options="ctrl.getMetricAggTypes()"
          on-change="ctrl.onAggTypeChange()"
          custom="false"
          css-class="width-10">
        </metric-segment-model>
        <metric-segment-model ng-if="ctrl.getMetricAggDef(agg.type).requiresColumn"
          property="agg.column"
          get-options="ctrl.getColumns()"
          on-change="ctrl.onChange()"
          css-class="width-12">
        </metric-segment-model>
      </div>

      <div class="gf-form gf-form--grow">
        <label class="gf-form-label gf-form-label--grow">
          <a ng-click="toggleOptions()" ng-if="settingsLinkText">
            <i class="fa fa-caret-down" ng-show="showOptions"></i>
            <i class="fa fa-caret-right" ng-hide="showOptions"></i>
              {{settingsLinkText}}
          </a>
        </label>
      </div>

      <div class="gf-form">
        <label class="gf-form-label" ng-if="isFirst">
          <a class="pointer" ng-click="addMetricAgg()"><i class="fa fa-plus"></i></a>
        </label>
        <label class="gf-form-label" ng-if="!isSingle">
          <a class="pointer" ng-click="removeMetricAgg()"><i class="fa fa-minus"></i></a>
        </label>
      </div>
    </div>

    <div class="gf-form-inline">
      <div class="gf-form">
        <label class="gf-form-label query-keyword width-7">ORDER BY</label>
        <metric-segment segment="ctrl.orderBySegment"
          get-options="ctrl.getOrderByColumns()"
          on-change="ctrl.orderByChanged()">
        </metric-segment>
      </div>
      <div class="gf-form">
        <!-- ASC/DESC -->
        <metric-segment segment="ctrl.orderTypeSegment"
          get-options="ctrl.getOrderTypes()"
          on-change="ctrl.orderByChanged()">
        </metric-segment>
      </div>
      <div class="gf-form">
        <label class="gf-form-label query-keyword width-7">ALIAS BY</label>
        <metric-segment segment="ctrl.aliasBySegment"
          get-options="ctrl.getColumns()"
          on-change="ctrl.aliasBySegmentChanged()">
        </metric-segment>
      </div>
      <div class="gf-form">
        <label class="gf-form-label query-keyword width-12">GROUP RESPONSE BY</label>
        <metric-segment segment="ctrl.groupResponseBySegment"
          get-options="ctrl.getColumns()"
          on-change="ctrl.groupResponseBySegmentChanged()">
        </metric-segment>
      </div>
      <div class="gf-form gf-form--grow">
        <div class="gf-form-label gf-form-label--grow"></div>
      </div>
    </div>
  </div>

</query-editor-row>
